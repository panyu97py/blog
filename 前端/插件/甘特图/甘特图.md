# [ç”˜ç‰¹å›¾](https://github.com/DHTMLX/gantt)

## äº‹æƒ…æ˜¯è¿™æ ·çš„ ğŸ‘€

- æ—©äº›æ—¶å€™ï¼Œæˆ‘æ¥åˆ°äº†ä¸€ä¸ªéœ€æ±‚ï¼Œè¯´è¦å°†é¡¹ç›®é‡Œç¨‹ç¢‘ç”¨ç”˜ç‰¹å›¾å±•ç¤ºï¼Œä¸€è„¸æ‡µé€¼çš„æˆ‘å…ˆæ˜¯æœä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œç”˜ç‰¹å›¾â€ ğŸ§ï¼š

> From ç™¾åº¦ç™¾ç§‘ï¼šç”˜ç‰¹å›¾ï¼ˆGantt chartï¼‰åˆç§°ä¸ºæ¨ªé“å›¾ã€æ¡çŠ¶å›¾(Bar chart)ã€‚å…¶é€šè¿‡æ¡çŠ¶å›¾æ¥æ˜¾ç¤ºé¡¹ç›®ï¼Œè¿›åº¦ï¼Œå’Œå…¶ä»–æ—¶é—´ç›¸å…³çš„ç³»ç»Ÿè¿›å±•çš„å†…åœ¨å…³ç³»éšç€æ—¶é—´è¿›å±•çš„æƒ…å†µã€‚

- é…åˆå›¾ç‰‡æ„Ÿå— ğŸ˜°ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1)

- å¿ƒæƒ³ï¼Œåˆšå¥½æœ€è¿‘ç”¨ [echarts](https://www.echartsjs.com/zh/index.html) ç”»è¿‡è®¸å¤šå›¾è¡¨ï¼Œè¿™è´§åº”è¯¥ä¹Ÿèƒ½ç”¨ `echarts` æ¥å®ç°ï¼Œå†å°½åƒè¾›å’Œä¸‡è‹¦ï¼Œäºæ˜¯æœ‰äº†ğŸ‘‡ï¼š

![img](./ç”˜ç‰¹å›¾.assets/17124de20c214c80.gif)

- äº§å“ä¸€çœ‹ï¼Œè¯´ï¼šâ€œè¿™ä¸æ˜¯æˆ‘è¦çš„ç”˜ç‰¹å›¾ï¼Œé‡åšï¼â€ï¼Œç¼“ç¼“åœ°æ‰“å‡ºä¸€ä¸ªâ€œå¥½çš„â€ï¼Œå®é™…ä¸Šå¿ƒæƒ…å¦‚ğŸ‘‡å›¾ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639449)

- åœ¨ `github` ä¸Šä¸€æœï¼Œç”˜ç‰¹å›¾ç»„ä»¶ä¸ç®—å¤šï¼Œç”±äºæ—¶é—´ç´§æ€¥ï¼Œå½“æ—¶è¿˜æ²¡å‘ç°åªæœ‰413ä¸ª ğŸŒŸçš„çœŸå‘½å¤©å­ï¼ˆ`dhtmlxGantt`ï¼‰ğŸ˜­ï¼Œä»…è¯•ç”¨äº†å‰é¢4æ¬¾ ğŸŒŸæ¯”è¾ƒå¤šçš„ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639475)

- ç»“æœå‡æ˜¯ä»¥å¤±è´¥å‘Šç»ˆï¼ˆä¸ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼Œæ”¹é€ éš¾åº¦å¤§ï¼‰ã€‚

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639472)

- è°ƒæ•´ä¸€ä¸‹å¿ƒæƒ…ï¼Œé‡æ–°è¸ä¸Šç”˜ç‰¹å›¾ç»„ä»¶è°ƒç ”ä¹‹è·¯ ğŸ¤•ï¼Œç»ˆäºï¼Œè¢«æˆ‘å‘ç°äº† [Top 5 : Best free jQuery and JavaScript Dynamic Gantt Charts for web applications](https://ourcodeworld.com/articles/read/434/top-5-best-free-jquery-and-javascript-dynamic-gantt-charts-for-web-applications) è¿™ä¸ªç½‘ç«™ï¼ŒçœŸå‘½å¤©å­ `dhtmlxGantt` æ’åTOP1ï¼Œäºæ˜¯æˆ‘å¼€å§‹å¯¹å…¶è¿›è¡Œäº†è¯•ç”¨åŠç ”ç©¶ã€‚
- ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œç»ˆäºåšå‡ºäº†ç¬¦åˆä¸šåŠ¡æ–¹éœ€æ±‚çš„ç”˜ç‰¹å›¾ ğŸ‘‡ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1712419fb42c2356.gif)

- æœ‰ä¸€è¯´ä¸€ï¼Œä¸ `echarts` æ¨¡æ‹Ÿçš„ç”˜ç‰¹å›¾ä¸€æ¯”ï¼Œ`dhtmlxGantt` ç¡®å®åŠŸèƒ½å¼ºå¤§äº†è®¸å¤šï¼Œé™¤äº†èƒ½å®ç°å¯¹é‡è¦æ—¥æœŸï¼ˆå¦‚ä»Šæ—¥/é¡¹ç›®å¼€å§‹æ—¶é—´/é¡¹ç›®ç»“æŸæ—¶é—´ç­‰ï¼‰è¿›è¡Œæ ‡ç¤ºã€tooltipã€é‡Œç¨‹ç¢‘çŠ¶æ€åŒºåˆ†ç­‰åŠŸèƒ½ä¹‹å¤–ï¼Œæœ€é‡è¦çš„æ˜¯å¯ä»¥å®ç°æŒ‰æ—¶/æ—¥/æœˆ/å¹´çš„åˆ‡æ¢ã€‚
- ç”±äº `dhtmlxGantt` æœ‰å…è´¹ç‰ˆå’Œä»˜è´¹ç‰ˆï¼Œä¸€å¼€å§‹è¯•ç”¨ä¹Ÿä¸çŸ¥é“æˆä¸æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä¸‹è½½äº†å…è´¹ç‰ˆçš„[æºç ](https://dhtmlx.com/docs/products/dhtmlxGantt/download/thankyou.shtml)è¿›è¡Œäº†ä¸€ç•ªç ”ç©¶ï¼Œå¹¸å¥½æœ€åçš„ç»“æœä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸€äº›é…ç½®æ¥å®ç°éœ€æ±‚ï¼Œä¸‹é¢å°†ä»‹ç»æ€ä¹ˆå®ç°ã€‚

## é€šè¿‡é…ç½® dhtmlxGantt å®ç°çš„åŠŸèƒ½

### åœ¨ react é¡¹ç›®ä¸­ä½¿ç”¨

- `dhtmlxGantt` åœ¨ [github](https://github.com/DHTMLX/gantt) æä¾›äº†åœ¨ `Vue.js/Angular/React` é¡¹ç›®ä¸­çš„ä½¿ç”¨æ–¹æ³•å…¥å£ï¼Œæœ¬æ–‡å°†å¯¹å¦‚ä½•åœ¨ react é¡¹ç›®ä¸­ä½¿ç”¨è¿›è¡Œä»‹ç»ï¼ˆç»å®è·µï¼‰ã€‚
- ä¸‹è½½å‘½ä»¤ï¼š

```bash
yarn add dhtmlx-gantt
å¤åˆ¶ä»£ç 
```

- åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```bash
import 'dhtmlx-gantt';
import 'dhtmlx-gantt/codebase/dhtmlxgantt.css';
import 'dhtmlx-gantt/codebase/ext/dhtmlxgantt_marker.js';
import 'dhtmlx-gantt/codebase/ext/dhtmlxgantt_tooltip.js';
import 'dhtmlx-gantt/codebase/locale/locale_cn.js';
import * as React from 'react';
import { getGanttConfigByZoomValue } from '../../utils/milestone.lib';
import Toolbar from './components/Toolbar';
import * as styles from './index.module.less';

export default class Gantt extends React.Component<any> {
  state = {
    currentZoom: 'Days', // é»˜è®¤æŒ‰æ—¥ç»´åº¦å±•ç¤º
    isMount: false,
  };

  private ganttContainer: any;

  componentWillReceiveProps (nextProps: any) {
    this.generateGantt();
    this.setState({ isMount: true });
  }

  handleZoomChange = (zoom: string) => {
    this.setState({ currentZoom: zoom }, () => {
      this.generateGantt();
    });
  }

  async generateGantt () {
    const { ganttData } = this.props;
    if (this.state.isMount) { // è‹¥ä¸åŠ åˆ¤æ–­ï¼Œé¦–æ¬¡ä½¿ç”¨ä¼šæŠ¥é”™
      gantt.clearAll(); // ç§»é™¤æ‰€æœ‰ä»»åŠ¡ï¼Œå¦åˆ™æ›´æ–°æ—¶ä»»åŠ¡ä¼šå åŠ 
    }
    this.setConfig(); // æ·»åŠ é…ç½®
    gantt.init(this.ganttContainer); // åˆå§‹åŒ– dhtmlxGantt åˆ° ganttContainer å®¹å™¨ä¸­
    gantt.parse(ganttData); // å°†æ•°æ®æ³¨å…¥åˆ°ç”˜ç‰¹å›¾
  }

  setConfig () {
    ...
  }

  setZoom (value: string) {
    gantt.config = {
      ...gantt.config,
      ...getGanttConfigByZoomValue(value), // æ ¹æ®ç»´åº¦å±•ç¤ºä¸åŒçš„æ—¥æœŸæ ¼å¼
    };
  }

  renderContent () {
    const { currentZoom } = this.state;
    return (
      <React.Fragment>
        <div className={styles.zoomBar}>
          <Toolbar zoom={currentZoom} onZoomChange={this.handleZoomChange} />
        </div>
        <div className={styles.gantt}}>
          <div
            ref={input => {
              this.ganttContainer = input;
            }}
            style={{ width: '100%', height: '100%' }}
          />
        </div>
      </React.Fragment>
    );
  }
  
  render () {
    return (
      <div className={styles.ganttWrapper}>
        {this.renderContent()}
      </div>
    );
  }
}
å¤åˆ¶ä»£ç 
```

- æ ¹æ® `setConfig` å’Œ `setZoom` æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹ `gantt` å®ä¾‹è¿›è¡Œæ“ä½œæ¥å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚

### åªè¯»æ¨¡å¼

- åœ¨åˆå§‹åŒ– `dhtmlxGantt` ä¹‹å‰ï¼Œé€šè¿‡å°† `gantt.config.readonly` è®¾ç½®ä¸º `true` æ¥é™åˆ¶ç”˜ç‰¹å›¾ä¸ºåªè¯»æ¨¡å¼ï¼š

```bash
gantt.config.readonly = true;
gantt.init(this.ganttContainer);
å¤åˆ¶ä»£ç 
```

- å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡è®¾ç½®äº†åªè¯»æ¨¡å¼ï¼Œè¡¨æ ¼è¡Œè¢«é€‰ä¸­åæ— æ³•å–æ¶ˆé€‰ä¸­ï¼ŒåŒæ—¶ï¼Œè¡¨æ ¼åˆ—æœ€å³è¾¹ä»æœ‰â•å·æŒ‰é’®ï¼Œè™½ç„¶ç‚¹äº†æ²¡æœ‰ååº”ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639394)

- è§£å†³è¡¨æ ¼è¡Œè¢«é€‰ä¸­åæ— æ³•å–æ¶ˆé€‰ä¸­çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è®¾ç½®å³å¯è§£å†³ï¼š

```bash
gantt.config.readonly = true; // å¼€å¯åªè¯»æ¨¡å¼
select_task: false, // ç¦æ­¢ä»»åŠ¡è¢«é€‰ä¸­,
gantt.init(this.ganttContainer);
å¤åˆ¶ä»£ç 
```

- è‡³äºè¡¨æ ¼åˆ—æœ€å³è¾¹ä»æœ‰â•å·æŒ‰é’®çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰è¡¨æ ¼åˆ—æ¥è§£å†³ ğŸ‘‡ã€‚

### è‡ªå®šä¹‰è¡¨æ ¼åˆ—

- è¡¨æ ¼åˆ—è®¾ç½®å¦‚ä¸‹ï¼š

```bash
gantt.config.columns = [
  {
    name: 'text',
    label: 'é‡Œç¨‹ç¢‘èŠ‚ç‚¹',
    width: 280,
    template: function (obj: any) {
      return `èŠ‚ç‚¹ï¼š${obj.text}`; // é€šè¿‡ template å›è°ƒå¯ä»¥æŒ‡å®šè¿”å›å†…å®¹å€¼
    },
  },
];
gantt.init(this.ganttContainer);
å¤åˆ¶ä»£ç 
```

- ç»“æœå¦‚ä¸‹ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639419)

### è‡ªå®šä¹‰tooltip

- å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰é¼ æ ‡ç§»åŠ¨åˆ°ä»»åŠ¡ä¸Šçš„ tooltip æç¤ºï¼Œéå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯éœ€è¦å¼•å…¥ `dhtmlxgantt_tooltip.js`ï¼Œæ‰å¯ä»¥ä½¿ç”¨é€šè¿‡ `gantt.attachEvent` æ–¹æ³•æ·»åŠ  tooltipï¼Œç„¶åå¯ä»¥å¼€å§‹è¿›è¡Œè‡ªå®šä¹‰ï¼š

```
// è‡ªå®šä¹‰tooltipå†…å®¹
gantt.templates.tooltip_text = function (start: Date, end: Date, task: any) {
  const t = gantt;
  const output = `<b>é‡Œç¨‹ç¢‘ï¼š</b>${task.text}<br/><b>çŠ¶æ€ï¼š</b>${
    MILESTONE_STATE_MAP[task.state]
    }<br/><b>è®¡åˆ’å¼€å§‹æ—¶é—´ï¼š</b>${t.templates.tooltip_date_format(
    start,
    )}<br/><b>è®¡åˆ’ç»“æŸæ—¶é—´ï¼š</b>${t.templates.tooltip_date_format(end)}`;
  return output;
},
// æ·»åŠ tooltip
gantt.attachEvent('onGanttReady', function () {
  var tooltips = gantt.ext.tooltips;
  tooltips.tooltip.setViewport((gantt as any).$task_data);
});
å¤åˆ¶ä»£ç 
```

- å½“é¼ æ ‡ç§»åŠ¨åˆ°é¡¹ç›®ä¸Šæ—¶ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ tooltip å†…å®¹ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639450)

### å±•ç¤ºä»Šæ—¥ã€é¡¹ç›®å¼€å§‹å’Œç»“æŸæ ‡ç¤ºçº¿

- ä¸ tooltip åŠŸèƒ½ç±»ä¼¼ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨æ ‡ç¤ºçº¿çš„åŠŸèƒ½ï¼Œéœ€è¦å¼•å…¥ `dhtmlxgantt_marker.js`ï¼Œè¿™æ ·æ‰èƒ½é€šè¿‡ `gantt.addMarker` æ–¹æ³•ä¸ºä¸€äº›é‡è¦æ—¥æœŸçš„å¢åŠ æ ‡ç¤ºï¼š

```bash
const { online_date, offline_date } = this.props;
// ä»Šæ—¥çº¢çº¿
let today = new Date(`${getEndOfDate()}`); // getEndOfDate ä¸ºè·å–ä»Šå¤©ç»“æŸæ—¶é—´çš„æ–¹æ³•
gantt.addMarker({
    start_date: today,
    css: 'today',
    text: 'ä»Šæ—¥',
});

// é¡¹ç›®å¼€å§‹æ—¶é—´
if (online_date) {
  gantt.addMarker({
    start_date: online_date,
    css: 'projectStartDate',
    text: 'é¡¹ç›®å¼€å§‹',
  });
}

// é¡¹ç›®ç»“æŸæ—¶é—´
if (offline_date) {
  gantt.addMarker({
    start_date: offline_date,
    css: 'projectEndDate',
    text: 'é¡¹ç›®ç»“æŸ',
  });
}
å¤åˆ¶ä»£ç 
```

- éœ€è¦æ³¨æ„ âš ï¸ï¼šé™¤äº†ä»Šæ—¥æ ‡ç¤ºçº¿å·²ç»æœ‰é»˜è®¤æ ·å¼ä»¥å¤–ï¼Œæ–°å¢åŠ çš„æ ‡ç¤ºçº¿éœ€è¦æŒ‡å®šcssç±»åæ¥å¢åŠ æ ·å¼ï¼š

```bash
.projectStartDate, .projectEndDate {
  background: #00bcd4;
}
å¤åˆ¶ä»£ç 
```

- ç»“æœï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639471)

### è‡ªå®šä¹‰ä»»åŠ¡é¢œè‰²

- å¯ä»¥é€šè¿‡è®¾ç½® `gantt.templates.task_class` å®ç°ä»»åŠ¡é¢œè‰²è‡ªå®šä¹‰ï¼š

```bash
task_class: function (start: Date, end: Date, task: any) {
  return `milestone-${task.state}`; // task.stateå€¼ä¸ºdefault/unfinished/finished/canceledå…¶ä¸­ä¸€ç§
},
å¤åˆ¶ä»£ç 
```

- css:

```bash
.milestone-default {
  border: none;
  background: rgba(0, 0, 0, 0.45);
}
.milestone-unfinished {
  border: none;
  background: #5692f0;
}
.milestone-finished {
  border: none;
  background: #84bd54;
}
.milestone-canceled {
  border: none;
  background: #da645d;
}
å¤åˆ¶ä»£ç 
```

### é«˜äº®å‘¨æœ«æ—¥æœŸé¢œè‰²

- ç”±äºå…¬å¸å‘¨æœ«ä¸ä¸Šç­ ğŸ˜„ï¼Œå¯ä»¥å°†å‘¨æœ«æ—¥æœŸé¢œè‰²è¿›è¡Œé«˜äº®ï¼š

```bash
// çªå‡ºå‘¨æœ«é¢œè‰²
(gantt.templates as any).timeline_cell_class = function (item: any, date: Date): string {
  if (date.getDay() === 0 || date.getDay() === 6) {
    return 'weekend';
  }
  return '';
};
å¤åˆ¶ä»£ç 
```

- ç»“æœï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639488)

- å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæŒ‰æœˆå’ŒæŒ‰å¹´è§†å›¾å±•ç¤ºï¼Œä¼šç”¨å½“å‰åˆ—çš„æ—¶é—´å»åšè®¡ç®—ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´å‘¨/æ•´æœˆéƒ½è¢«é«˜äº®ï¼Œè¿™æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œé‚£å°±æ”¹é€ ä¸€ä¸‹å§ï¼š

```bash
// çªå‡ºå‘¨æœ«é¢œè‰²
const disableHighlight =
  this.state.currentZoom === 'Years' || this.state.currentZoom === 'Months';
(gantt.templates as any).timeline_cell_class = function (item: any, date: Date): string {
  if (!disableHighlight && (date.getDay() === 0 || date.getDay() === 6)) {
    return 'weekend';
  }
  return '';
};
å¤åˆ¶ä»£ç 
```

- å¯ä»¥çœ‹åˆ°ï¼Œä¸‰æœˆè¿™ä¸€åˆ—å˜æ­£å¸¸äº†ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1-20210614161639511)

### åˆ‡æ¢è§†å›¾

- åˆ‡æ¢è§†å›¾çš„ `Toolbar` ç»„ä»¶åœ¨[æ–‡æ¡£](https://dhtmlx.com/blog/create-react-gantt-chart-component-dhtmlxgantt/)ä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸è¿›è¡Œå¤è¿°äº†ï¼Œæ ¸å¿ƒæ˜¯`getGanttConfigByZoomValue`æ–¹æ³•ï¼Œç”¨äºè®¾ç½®ä¸åŒè§†å›¾çš„å…·ä½“æ—¶é—´æ ¼å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š

```bash
export function getGanttConfigByZoomValue (value: string) {
  switch (value) {
    case 'Hours':
      return {
        scale_unit: 'day',
        scale_height: 50,
        min_column_width: 30,
        date_scale: '%Y-%m-%d',
        subscales: [
          {
            unit: 'hour',
            step: 1,
            date: '%H',
          },
        ],
      };
    case 'Days':
      return {
        scale_unit: 'week',
        scale_height: 50,
        min_column_width: 70,
        date_scale: '%Yå¹´ %Wå‘¨',
        subscales: [
          {
            unit: 'day',
            step: 1,
            date: '%m-%d',
          },
        ],
      };
    case 'Months':
      return {
        scale_unit: 'month',
        scale_height: 50,
        min_column_width: 70,
        date_scale: '%Y-%m',
        subscales: [
          {
            unit: 'week',
            step: 1,
            date: '%Wå‘¨',
          },
        ],
      };
    case 'Years':
      return {
        scale_unit: 'year',
        scale_height: 50,
        min_column_width: 70,
        date_scale: '%Yå¹´',
        subscales: [
          {
            unit: 'month',
            step: 1,
            date: '%M',
          },
        ],
      };
    default:
      return {};
  }
}
å¤åˆ¶ä»£ç 
```

- é€šè¿‡ä¸Šé¢ä»‹ç»çš„é…ç½®ï¼Œå³å¯å®ç°ç¬¦åˆä¸šåŠ¡æ–¹éœ€æ±‚çš„ç”˜ç‰¹å›¾ ğŸ‘‡ï¼š

![img](./ç”˜ç‰¹å›¾.assets/1712419fb42c2356.gif)

## æ€»